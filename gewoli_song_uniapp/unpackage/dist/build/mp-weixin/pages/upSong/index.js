(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/upSong/index"],{1249:function(e,n,o){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o("4a78"),t={data:function(){return{songFileName:"",list:[{checked:!0,disabled:!1}],form:{songName:"测试歌曲名",lyricist:"测试作词人",composer:"测试作曲人",songTitle:"",currentPrice:"10",originalPrice:"20",songCoverPhotoUrl:"",songFileUrl:"https://image-file2024.oss-cn-beijing.aliyuncs.com/geWoLiMusicMall/song/f1e22173-dcad-4fd5-b64c-e0521457071b.mp3",songLyrics:"",songTypeId:"",source:0},loginType:0,typeList:[],show:!1}},computed:{titleHeight:function(){return getApp().globalData.titleHeight},userInfo:function(){return e.getStorageSync("userInfo")}},onLoad:function(e){var n=e.loginType;this.getType(),this.loginType=n},methods:{select:function(e){this.form.songCoverPhotoUrl=e.tempFilePaths[0]},upAudio:function(){var n=this;e.showLoading(),e.chooseMessageFile({count:1,extension:[".mp3"],success:function(o){e.uploadFile({url:i.BASEURL+"/file/ossUpload?type=3",filePath:o.tempFiles[0].path,fileType:"audio",name:"file",header:{Authorization:"Bearer "+e.getStorageSync("token")||!1,"content-type":"application/x-www-form-urlencoded"},success:function(i){var t=JSON.parse(i.data);200==t.code&&(n.songFileName=o.tempFiles[0].name,n.form.songFileUrl=t.msg),e.hideLoading()},fail:function(n){console.log(n),e.hideLoading()}})},fail:function(n){console.log(n),e.hideLoading()}})},upSongLyrics:function(){var n=this;e.showLoading(),e.chooseMessageFile({count:1,extension:[".lrc"],success:function(o){e.uploadFile({url:i.BASEURL+"/file/songLyrics",filePath:o.tempFiles[0].path,name:"file",header:{Authorization:"Bearer "+e.getStorageSync("token")||!1},formData:{songLyrics:"file"},success:function(o){console.log(o);var i=JSON.parse(o.data);200==i.code&&(n.form.songLyrics=i.data),e.hideLoading()},fail:function(n){console.log(n),e.hideLoading()}})},fail:function(n){console.log(n),e.hideLoading()}})},confirmSongTitle:function(e){var n=e[0];this.form.songTitle=this.typeList[n].typeName,this.form.songTypeId=this.typeList[n].id},getType:function(){var e=this;this.$req.get("system/type/list?pageNum=1&pageSize=99").then((function(n){e.typeList=n.rows}))},submit:function(){var n=this;if(!this.validate())return!1;this.form.userId=this.userInfo.id,e.uploadFile({url:i.BASEURL+"/file/ossUpload?type=2",filePath:this.form.songCoverPhotoUrl,fileType:"image",name:"file",header:{Authorization:"Bearer "+e.getStorageSync("token")||!1},success:function(o){var i=JSON.parse(o.data);200==i.code?(n.form.songCoverPhotoUrl=i.msg,n.form.createBy=n.userInfo.nickName,console.log(n.form),setTimeout((function(){n.upInfo()}),100)):e.showToast({title:"请求失败，请稍后充实",icon:"none"})}})},upInfo:function(){var n=e.getStorageSync("userInfo");null==n.name?this.form.createBy=n.nickName:this.form.createBy=n.name;var o=JSON.parse(JSON.stringify(this.form));this.$req.post("system/song",o).then((function(n){200==n.code?e.showToast({title:"提交成功！",icon:"none",success:function(){setTimeout((function(){e.navigateBack()}),1e3)}}):e.showToast({title:"请求失败!请稍后重试！",icon:"none"})}))},validate:function(){var n=!0,o="",i=this.form;return i.songName||(o="请填写歌曲名",n=!1),i.lyricist||(o="请填写作词人",n=!1),i.composer||(o="请填写作曲人",n=!1),i.songTitle||(o="请选择歌曲风格",n=!1),i.currentPrice||(o="请填写售价",n=!1),i.originalPrice||(o="请填写原价",n=!1),i.songCoverPhotoUrl||(o="请上传封面图",n=!1),i.songFileUrl||(o="请上传mp3",n=!1),i.songLyrics||(o="请上传完整歌词",n=!1),n||e.showToast({title:o,icon:"none"}),n}}};n.default=t}).call(this,o("543d")["default"])},2719:function(e,n,o){"use strict";(function(e,n){var i=o("4ea4");o("4812");i(o("66fd"));var t=i(o("ce29"));e.__webpack_require_UNI_MP_PLUGIN__=o,n(t.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},5873:function(e,n,o){"use strict";o.r(n);var i=o("1249"),t=o.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){o.d(n,e,(function(){return i[e]}))}(s);n["default"]=t.a},"7cbd":function(e,n,o){"use strict";var i=o("ec10"),t=o.n(i);t.a},ce29:function(e,n,o){"use strict";o.r(n);var i=o("eabc"),t=o("5873");for(var s in t)["default"].indexOf(s)<0&&function(e){o.d(n,e,(function(){return t[e]}))}(s);o("7cbd");var r=o("f0c5"),c=Object(r["a"])(t["default"],i["b"],i["c"],!1,null,"c3c4270a",null,!1,i["a"],void 0);n["default"]=c.exports},eabc:function(e,n,o){"use strict";o.d(n,"b",(function(){return t})),o.d(n,"c",(function(){return s})),o.d(n,"a",(function(){return i}));var i={uIcon:function(){return o.e("uview-ui/components/u-icon/u-icon").then(o.bind(null,"7154"))},uPicker:function(){return Promise.all([o.e("common/vendor"),o.e("uview-ui/components/u-picker/u-picker")]).then(o.bind(null,"def1"))},uniFilePicker:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(o.bind(null,"f842"))}},t=function(){var e=this,n=e.$createElement;e._self._c;e._isMounted||(e.e0=function(n){e.show=!0})},s=[]},ec10:function(e,n,o){}},[["2719","common/runtime","common/vendor"]]]);