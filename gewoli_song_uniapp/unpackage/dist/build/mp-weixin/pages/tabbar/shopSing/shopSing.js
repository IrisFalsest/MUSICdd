(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabbar/shopSing/shopSing"],{"30f4":function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("4812");i(n("66fd"));var o=i(n("8772"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"35e8":function(t,e,n){"use strict";var i=n("bd5c"),o=n.n(i);o.a},"76f3":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var i={heads:function(){return n.e("components/heads/heads").then(n.bind(null,"3ce6"))},uSearch:function(){return n.e("uview-ui/components/u-search/u-search").then(n.bind(null,"3457"))},uEmpty:function(){return n.e("uview-ui/components/u-empty/u-empty").then(n.bind(null,"bfee"))},tTabs:function(){return n.e("components/tTabs/tTabs").then(n.bind(null,"977b"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"f8c6"))},uTabbar:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-tabbar/u-tabbar")]).then(n.bind(null,"d781"))}},o=function(){var t=this.$createElement,e=(this._self._c,this.isSearch?this.searchList.length:null),n=this.isSearch?this.searchList.length:null;this.$mp.data=Object.assign({},{$root:{g0:e,g1:n}})},s=[]},8772:function(t,e,n){"use strict";n.r(e);var i=n("76f3"),o=n("f84a");for(var s in o)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(s);n("35e8");var a=n("f0c5"),r=Object(a["a"])(o["default"],i["b"],i["c"],!1,null,"37de5532",null,!1,i["a"],void 0);e["default"]=r.exports},"8df6":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={data:function(){return{timerId:null,searchTxt:"",isSearch:!1,searchList:[],cIndex:0,scrollTop:0,value:"",windowHeight:0,headHeight:0,tabViewHeight:0,tv2Height:0,typeList:[{typeName:"不限"}],songList:[],curItem:{},timer:null,innerAudioContext:null}},components:{PlayBottom:function(){n.e("components/PlayBottom").then(function(){return resolve(n("7902"))}.bind(null,n)).catch(n.oe)}},computed:{listHeight:function(){var t=this.windowHeight-this.headHeight-this.tabViewHeight-this.tv2Height-60;return t.toFixed(2)},tabbar:function(){return getApp().globalData.tabbar},userInfo:function(){return t.getStorageSync("userInfo")}},watch:{searchTxt:function(t,e){""==t&&(this.isSearch=!1)}},onShow:function(){this.$refs.playBottomRef.updatePlayObj()},onLoad:function(){var e=this;this.getType(),t.getSystemInfo({success:function(t){e.windowHeight=t.windowHeight}});var n=t.createSelectorQuery().in(this);n.select(".head").boundingClientRect((function(t){t&&(e.headHeight=t.height)})).exec(),n.select(".tabView").boundingClientRect((function(t){t&&(e.tabViewHeight=t.height)})).exec(),n.select(".tv2").boundingClientRect((function(t){t&&(e.tv2Height=t.height)})).exec()},onShareAppMessage:function(t){return{title:"歌窝里歌单",path:"/pages/tabbar/shopSing/shopSing"}},methods:{audition:function(e,n,i){clearTimeout(this.$globalDataAudio.timer),this.$globalDataAudio.timer=null;var o=this.$globalDataAudio.audioCtx;o.src=e.songFileUrl,o.play(),this.$globalDataAudio.timer=setTimeout((function(){o.stop(),t.showModal({title:"提示",content:"试听结束，购买后可播放",success:function(t){t.confirm?console.log("用户点击确定"):t.cancel&&console.log("用户点击取消")}})}),25e3)},open:function(e){t.navigateTo({url:"/pages/songBuying/songBuying?item="+JSON.stringify(e)}),this.curItem=e},buy:function(e){var n=this,i=this;console.log(e);var o=this.curItem,s=t.getStorageSync("userInfo").roleType,a=t.getStorageSync("userInfo").musiciansSignStatus;if("2"==s&&"3"!==a)return t.showToast({title:"请签约后购买",icon:"none"}),void t.navigateTo({url:"/pages/upUserInfo/upExamine"});var r={userId:t.getStorageSync("userInfo").id,goodsId:o.id,phone:t.getStorageSync("userInfo").reviewPhone,payMethod:1};2==e?r.payMethod=2:1==e&&(r.payMethod=1),this.$req.put("song/order/payment",r).then((function(e){if(e.data.timeStamp)t.requestPayment({provider:"wxpay",timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:"prepay_id="+e.data.packageStr,signType:"MD5",paySign:e.data.paySign,success:function(e){t.showToast({title:"支付成功",icon:"none"}),setTimeout((function(){n.toUrl("/pages/order/singOrderList")}),500),i.$refs.popup.close()},fail:function(e){t.showToast({title:"支付失败,请重试",icon:"none"}),i.$refs.popup.close()}});else{if(n.$refs.popup.close(),500==e.code)return void t.showToast({title:"积分不足",icon:"none"});t.showToast({title:"积分支付成功",icon:"none"}),setTimeout((function(){n.toUrl("/pages/order/singOrderList")}),500)}}))},search:function(){var t=this;if(""!=this.searchTxt){var e={songNameOrProducer:this.searchTxt};this.$req.get("song/searchSong",e).then((function(e){t.searchList=e.data,t.isSearch=!0}))}},playMp3:function(t,e,n){if(-1==n){var i=encodeURIComponent(JSON.stringify(this.searchList));this.toUrl("/pages/play/play?list=".concat(i,"&index=").concat(e))}var o=encodeURIComponent(JSON.stringify(this.songList[n]));this.toUrl("/pages/play/play?list=".concat(o,"&index=").concat(e))},collection:function(e,n,i,o){var s,a,r=this,u=JSON.parse(JSON.stringify(e)),c={songId:u.id,userId:this.userInfo.id};u.isCollect?(s="userSongCollection/deleteUserSongCollection",a=0):(s="userSongCollection/userSongCollection",a=1),this.$req.post(s,c,"form").then((function(e){200==e.code&&(o[i].isCollect=a,r.$set(r.songList,n,o)),t.showToast({title:e.msg,icon:"none"})}))},getType:function(){var t=this;this.$req.get("system/type/list?pageNum=1&pageSize=99").then((function(e){e.rows.unshift({typeName:"不限"}),t.typeList=e.rows,t.songList=JSON.parse(JSON.stringify(e.rows)),t.songList[0]=[],e.rows.forEach((function(e,n){t.getList(e.id,n)}))}))},getList:function(t,e){var n=this,i={songType:t||0,userId:this.userInfo.id};this.$req.get("song/acquisitionSong",i).then((function(t){n.$set(n.songList,e,t.data)}))},changeIndex:function(t){this.cIndex=t}}};e.default=i}).call(this,n("543d")["default"])},bd5c:function(t,e,n){},f84a:function(t,e,n){"use strict";n.r(e);var i=n("8df6"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=o.a}},[["30f4","common/runtime","common/vendor"]]]);